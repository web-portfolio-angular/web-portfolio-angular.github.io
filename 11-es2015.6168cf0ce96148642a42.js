(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{F15C:function(r,e,a){"use strict";a.r(e),a.d(e,"SellBuyCarModule",(function(){return pr}));var t=a("ofXK"),s=a("tyNb"),i=a("3Pt+"),c=a("d3UM"),n=a("fXoL"),o=a("1XCa");const l=function(){return["buy"]},g=function(){return["sell"]};let b=(()=>{class r{constructor(r){this.router=r}ngOnInit(){const r=JSON.parse(localStorage.getItem("sell-buy-car-LastVisitedLink"));r&&this.router.navigate([r])}saveLastVisitedLinkToLocalStore(r){localStorage.setItem("sell-buy-car-LastVisitedLink",JSON.stringify("/sell-buy-car/"+r))}}return r.\u0275fac=function(e){return new(e||r)(n.Lb(s.b))},r.\u0275cmp=n.Fb({type:r,selectors:[["app-sell-buy-car"]],decls:9,vars:4,consts:[[1,"container"],[1,"sell-buy-car"],[1,"sell-buy-car__router-links"],["routerLinkActive","categories-active",3,"routerLink","click"]],template:function(r,e){1&r&&(n.Rb(0,"div",0),n.Mb(1,"app-categories-info"),n.Rb(2,"div",1),n.Rb(3,"ul",2),n.Rb(4,"li",3),n.Yb("click",(function(){return e.saveLastVisitedLinkToLocalStore("buy")})),n.wc(5,"Buy Second Hand Car"),n.Qb(),n.Rb(6,"li",3),n.Yb("click",(function(){return e.saveLastVisitedLinkToLocalStore("sell")})),n.wc(7," Sell Your Car"),n.Qb(),n.Qb(),n.Mb(8,"router-outlet"),n.Qb(),n.Qb()),2&r&&(n.Ab(4),n.gc("routerLink",n.ic(2,l)),n.Ab(2),n.gc("routerLink",n.ic(3,g)))},directives:[o.a,s.d,s.c,s.f],encapsulation:2}),r})();var u=a("2CTM"),d=a("T/S4"),m=a("zy28"),h=a("rL3l"),p=a("V86y"),f=a("Vaw3"),I=a("B02C"),C=a("fk3A"),v=a("odcQ");function L(r,e){1&r&&n.Mb(0,"app-loading-spinner")}function R(r,e){if(1&r){const r=n.Sb();n.Rb(0,"div"),n.Rb(1,"button",6),n.Yb("click",(function(){return n.oc(r),n.ac().onEdit()})),n.wc(2,"Edit"),n.Qb(),n.Qb()}}function w(r,e){if(1&r&&n.Mb(0,"app-car-images",10),2&r){const r=n.ac(2);n.gc("carImgs",r.car.carImages)}}function F(r,e){if(1&r){const r=n.Sb();n.Rb(0,"div",7),n.Rb(1,"button",8),n.Yb("click",(function(){n.oc(r);const e=n.ac();return e.onShowCarImages(e.car.id)})),n.wc(2,"View Images"),n.Qb(),n.uc(3,w,1,1,"app-car-images",9),n.Qb()}if(2&r){const r=n.ac();n.Ab(3),n.gc("ngIf",r.carShowImages&&r.carId==r.car.id)}}function A(r,e){1&r&&(n.Rb(0,"p"),n.wc(1,"There are no images uploaded"),n.Qb())}function S(r,e){1&r&&(n.Rb(0,"div"),n.Rb(1,"p"),n.wc(2,"There are no images uploaded"),n.Qb(),n.Qb())}function Q(r,e){if(1&r&&(n.Rb(0,"div"),n.Mb(1,"img",21),n.Qb()),2&r){const r=e.$implicit;n.Ab(1),n.gc("src",r,n.pc)}}function y(r,e){if(1&r&&(n.Rb(0,"div"),n.Rb(1,"p"),n.wc(2,"Current Images"),n.Qb(),n.uc(3,Q,2,1,"div",20),n.Qb()),2&r){const r=n.ac(2);n.Ab(3),n.gc("ngForOf",r.currentCarImages)}}function M(r,e){if(1&r){const r=n.Sb();n.Rb(0,"div"),n.Mb(1,"img",21),n.Rb(2,"div",22),n.Yb("click",(function(){n.oc(r);const a=e.index;return n.ac(3).removeCarImg(a)})),n.wc(3,"X"),n.Qb(),n.Qb()}if(2&r){const r=e.$implicit;n.Ab(1),n.gc("src",r,n.pc)}}function E(r,e){if(1&r&&(n.Rb(0,"div"),n.Rb(1,"p"),n.wc(2,"New Images"),n.Qb(),n.Rb(3,"div"),n.uc(4,M,4,1,"div",20),n.Qb(),n.Qb()),2&r){const r=n.ac(2);n.Ab(4),n.gc("ngForOf",r.carImgLocalPaths)}}function k(r,e){1&r&&(n.Rb(0,"p"),n.wc(1,"Select Images"),n.Qb())}function U(r,e){1&r&&(n.Rb(0,"p"),n.wc(1,"Select More Images"),n.Qb())}function N(r,e){if(1&r&&(n.Rb(0,"p",23),n.wc(1),n.Qb()),2&r){const r=n.ac(2);n.Ab(1),n.xc(r.uploadCarImagesToFirestoreError)}}function D(r,e){if(1&r&&(n.Rb(0,"p",23),n.wc(1),n.Qb()),2&r){const r=n.ac(2);n.Ab(1),n.xc(r.updateSecondHandCarError)}}function O(r,e){if(1&r&&(n.Rb(0,"p",23),n.wc(1),n.Qb()),2&r){const r=n.ac(2);n.Ab(1),n.xc(r.setcarImgURLsError)}}function T(r,e){if(1&r){const r=n.Sb();n.Rb(0,"div",11),n.Rb(1,"form",12),n.Yb("ngSubmit",(function(){n.oc(r);const e=n.ac();return e.submitCarDetailChanges(e.changeCarDetailsForm)})),n.Rb(2,"div"),n.Mb(3,"textarea",13),n.Qb(),n.Rb(4,"div"),n.Mb(5,"input",14),n.Qb(),n.Rb(6,"div"),n.Rb(7,"div"),n.uc(8,S,3,0,"div",1),n.uc(9,y,4,1,"div",1),n.uc(10,E,5,1,"div",1),n.Qb(),n.Rb(11,"div"),n.Rb(12,"input",15,16),n.Yb("change",(function(e){return n.oc(r),n.ac().onChooseCarImgs(e)})),n.Qb(),n.Rb(14,"button",17),n.Yb("click",(function(){return n.oc(r),n.mc(13).click()})),n.uc(15,k,2,0,"p",1),n.uc(16,U,2,0,"p",1),n.Qb(),n.Qb(),n.Qb(),n.Rb(17,"div"),n.Rb(18,"button",18),n.wc(19,"Apply Changes"),n.Qb(),n.Rb(20,"button",6),n.Yb("click",(function(){return n.oc(r),n.ac().onCancel()})),n.wc(21,"Cancel"),n.Qb(),n.Qb(),n.Rb(22,"div"),n.uc(23,N,2,1,"p",19),n.uc(24,D,2,1,"p",19),n.uc(25,O,2,1,"p",19),n.Qb(),n.Qb(),n.Qb()}if(2&r){const r=n.ac();n.Ab(1),n.gc("formGroup",r.changeCarDetailsForm),n.Ab(7),n.gc("ngIf",!r.car.carImages),n.Ab(1),n.gc("ngIf",r.currentCarImages),n.Ab(1),n.gc("ngIf",r.carImgLocalPaths.length>0),n.Ab(5),n.gc("ngIf",!r.currentCarImages),n.Ab(1),n.gc("ngIf",r.currentCarImages),n.Ab(7),n.gc("ngIf",r.uploadCarImagesToFirestoreError),n.Ab(1),n.gc("ngIf",r.updateSecondHandCarError),n.Ab(1),n.gc("ngIf",r.setcarImgURLsError)}}const P=function(r){return{"background-image":r}};let x=(()=>{class r{constructor(r,e,a,t,s,i){this.subjectService=r,this.formBuilder=e,this.firestore=a,this.additionUserInfoService=t,this.angularFireStorage=s,this.generateIdService=i,this.isInEditMode=!1,this.ownerEmail=null,this.carImgNames=[],this.carImgLocalPaths=[],this.carImgURLs=[],this.currentCarImages=[],this.uploadCarImagesToFirestoreError=null,this.updateSecondHandCarError=null,this.setcarImgURLsError=null,this.isLoading=!1}ngOnInit(){this.additionUserInfoService.getUserAdditionalData(),this.userAdditionalInfoSub=this.additionUserInfoService.userAdditionalDataSubject.subscribe(r=>{this.userAdditionalData=r,this.ownerEmail=this.userAdditionalData[0].email}),this.carShowImagesSub=this.subjectService.carShowImagesSubject.subscribe(r=>{this.carShowImages=r}),this.carIdSub=this.subjectService.carIdSubject.subscribe(r=>{this.carId=r}),this.changeCarDetailsForm=this.formBuilder.group({description:new i.d(null,i.p.required),price:new i.d(null,i.p.required),carImgs:new i.d(null)}),this.currentCarImages=this.car.carImages}ngOnDestroy(){this.carShowImagesSub.unsubscribe(),this.carIdSub.unsubscribe(),this.userAdditionalInfoSub.unsubscribe()}onShowCarImages(r){this.subjectService.onShowCarImages(r)}submitCarDetailChanges(r){if(!r.valid)return;this.isLoading=!0;const e=this.car.id,a=this.car.model;this.onUploadCarImagesToFirestore(e).then(()=>{if(this.carImgNames.length>0)for(let t=0;t<this.carImgNames.length;t++)this.firestore.updateSecondHanImagesCar({id:e,img:r.value.carImgs[t],doc:a});this.firestore.updateSecondHandCar({description:r.value.description,price:r.value.price,id:e,doc:a}).then(()=>{this.isLoading=!1,this.updateSecondHandCarError=null},r=>{this.updateSecondHandCarError=r.message})})}onChooseCarImgs(r){if(this.carFiles=r.target.files,this.carFiles.length>0)for(let e=0;e<this.carFiles.length;e++){const a=new FileReader;a.onload=r=>{this.carImgLocalPaths.push(r.target.result)},a.readAsDataURL(r.target.files[e]),this.carImgNames.push(this.carFiles[e].name.substr(0,this.carFiles[e].name.lastIndexOf(".")))}else this.carFiles=null,this.carImgLocalPaths=[],this.carImgNames=[],this.changeCarDetailsForm.controls.carImgs.setValue("")}onUploadCarImagesToFirestore(r){return new Promise(e=>{0==this.carImgNames.length&&e();for(let a=0;a<this.carImgNames.length;a++)this.angularFireStorage.upload("/carsForSell/"+this.changeCarDetailsForm.value.model+"/"+this.userAdditionalData[0].email+"/"+r+"//carImages/"+this.carImgNames[a]+"-"+this.generateIdService.generateId(),this.carFiles[a]).then(r=>{r.ref.getDownloadURL().then(r=>{this.carImgURLs.push(r),this.carImgURLs.length==this.carImgNames.length&&(this.changeCarDetailsForm.value.carImgs=this.carImgURLs,this.setcarImgURLsError=null,e())}).catch(r=>{this.setcarImgURLsError=r.message}),this.uploadCarImagesToFirestoreError=null}).catch(r=>{this.uploadCarImagesToFirestoreError=r.message})})}onEdit(){this.changeCarDetailsForm.controls.description.setValue(this.car.description),this.changeCarDetailsForm.controls.price.setValue(this.car.price),this.isInEditMode=!0}removeCarImg(r){this.carImgLocalPaths.splice(r,1),this.carImgNames.splice(r,1),0==this.carImgLocalPaths&&0==this.carImgNames&&(this.changeCarDetailsForm.value.carImgs=null)}onCancel(){this.carFiles=null,this.carImgLocalPaths=[],this.carImgNames=[],this.changeCarDetailsForm.controls.carImgs.setValue(""),this.isInEditMode=!1}}return r.\u0275fac=function(e){return new(e||r)(n.Lb(h.a),n.Lb(i.c),n.Lb(d.a),n.Lb(p.a),n.Lb(f.a),n.Lb(I.a))},r.\u0275cmp=n.Fb({type:r,selectors:[["app-buy-car-item"]],inputs:{car:"car"},decls:32,vars:41,consts:[[1,"car-item"],[4,"ngIf"],[1,"car-item__img",3,"src"],[1,"comment-img",3,"ngStyle"],["class","car-item__images",4,"ngIf"],["class","test",4,"ngIf"],["type","button",3,"click"],[1,"car-item__images"],[1,"btn-default","narrow-btn",3,"click"],[3,"carImgs",4,"ngIf"],[3,"carImgs"],[1,"test"],[3,"formGroup","ngSubmit"],["formControlName","description"],["type","number","name","price","formControlName","price"],["formControlName","carImgs","type","file","accept",".png,.jpg,.jpeg,.svg,.heic","multiple","multiple",2,"display","none",3,"change"],["chooseCarImgs",""],["type","button",1,"btn-default","narrow-btn","ng-star-inserted",3,"click"],["type","submit"],["class","error-msg",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"src"],[3,"click"],[1,"error-msg"]],template:function(r,e){1&r&&(n.Rb(0,"div",0),n.uc(1,L,1,0,"app-loading-spinner",1),n.Mb(2,"img",2),n.Rb(3,"div"),n.Rb(4,"p"),n.wc(5),n.Qb(),n.Rb(6,"p"),n.wc(7),n.Qb(),n.Rb(8,"p"),n.wc(9),n.Qb(),n.Rb(10,"p"),n.wc(11),n.Qb(),n.Qb(),n.uc(12,R,3,0,"div",1),n.Rb(13,"p"),n.wc(14),n.bc(15,"date"),n.Qb(),n.Rb(16,"div"),n.Mb(17,"div",3),n.bc(18,"async"),n.bc(19,"getUserInfo"),n.Rb(20,"div"),n.wc(21),n.bc(22,"async"),n.bc(23,"getUserInfo"),n.bc(24,"async"),n.bc(25,"getUserInfo"),n.bc(26,"async"),n.bc(27,"getUserInfo"),n.Qb(),n.Qb(),n.Rb(28,"div"),n.uc(29,F,4,1,"div",4),n.uc(30,A,2,0,"p",1),n.Qb(),n.uc(31,T,26,9,"div",5),n.Qb()),2&r&&(n.Ab(1),n.gc("ngIf",e.isLoading),n.Ab(1),n.gc("src",e.car.carImg,n.pc),n.Ab(3),n.xc(e.car.model),n.Ab(2),n.xc(e.car.year),n.Ab(2),n.xc(e.car.description),n.Ab(2),n.xc(e.car.price),n.Ab(1),n.gc("ngIf",e.ownerEmail==e.car.owner),n.Ab(2),n.xc(n.dc(15,16,e.car.date.toDate(),"dd.MM.yyyy")),n.Ab(3),n.gc("ngStyle",n.jc(39,P,n.cc(18,19,n.dc(19,21,e.car.owner,"userImg")))),n.Ab(4),n.Ac(" ",n.cc(22,24,n.dc(23,26,e.car.owner,"name"))," ",n.cc(24,29,n.dc(25,31,e.car.owner,"phoneCode"))," ",n.cc(26,34,n.dc(27,36,e.car.owner,"phone"))," ",e.car.owner," "),n.Ab(8),n.gc("ngIf",e.car.carImages),n.Ab(1),n.gc("ngIf",!e.car.carImages),n.Ab(1),n.gc("ngIf",e.isInEditMode))},directives:[t.l,t.m,m.a,C.a,i.q,i.l,i.g,i.b,i.k,i.e,i.n,t.k],pipes:[t.e,t.b,v.a],styles:[".test[_ngcontent-%COMP%]{\n    position: fixed;\n    top: 50px;\n    left: 0;\n    width: 100%;\n    height: 100vh;\n    background-color: rgba(0, 0, 0, 0.5);\n  }\n\n  img[_ngcontent-%COMP%] {\n    width: 100px;\n  }"]}),r})();function j(r,e){1&r&&(n.Rb(0,"div"),n.Mb(1,"app-loading-spinner"),n.Qb())}function Y(r,e){1&r&&n.Mb(0,"app-buy-car-item",6),2&r&&n.gc("car",e.$implicit)}function V(r,e){if(1&r&&(n.Rb(0,"div",4),n.uc(1,Y,1,1,"app-buy-car-item",5),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.gc("ngForOf",r.audiCars)}}function H(r,e){if(1&r&&(n.Rb(0,"p",7),n.wc(1),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.xc(r.errorMsg)}}let q=(()=>{class r{constructor(r){this.firestore=r,this.isLoading=!0,this.errorMsg=null}ngOnInit(){this.firestore.getSecondHandAudi().subscribe(r=>{this.audiCars=r.map(r=>Object.assign({id:r.payload.doc.id},r.payload.doc.data())),this.isLoading=!1,this.errorMsg=null},r=>{this.isLoading=!1,this.errorMsg=r.message})}}return r.\u0275fac=function(e){return new(e||r)(n.Lb(d.a))},r.\u0275cmp=n.Fb({type:r,selectors:[["app-audi"]],decls:4,vars:3,consts:[[1,"cars-container"],[4,"ngIf"],["class","cars",4,"ngIf"],["class","error-msg",4,"ngIf"],[1,"cars"],[3,"car",4,"ngFor","ngForOf"],[3,"car"],[1,"error-msg"]],template:function(r,e){1&r&&(n.Rb(0,"div",0),n.uc(1,j,2,0,"div",1),n.uc(2,V,2,1,"div",2),n.uc(3,H,2,1,"p",3),n.Qb()),2&r&&(n.Ab(1),n.gc("ngIf",e.isLoading),n.Ab(1),n.gc("ngIf",!e.isLoading),n.Ab(1),n.gc("ngIf",e.errorMsg))},directives:[t.l,m.a,t.k,x],encapsulation:2}),r})();function _(r,e){1&r&&(n.Rb(0,"div"),n.Mb(1,"app-loading-spinner"),n.Qb())}function B(r,e){1&r&&n.Mb(0,"app-buy-car-item",6),2&r&&n.gc("car",e.$implicit)}function J(r,e){if(1&r&&(n.Rb(0,"div",4),n.uc(1,B,1,1,"app-buy-car-item",5),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.gc("ngForOf",r.bmwCars)}}function $(r,e){if(1&r&&(n.Rb(0,"p",7),n.wc(1),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.xc(r.errorMsg)}}let X=(()=>{class r{constructor(r){this.firestore=r,this.isLoading=!0,this.errorMsg=null}ngOnInit(){this.firestore.getSecondHandBMW().subscribe(r=>{this.bmwCars=r.map(r=>Object.assign({id:r.payload.doc.id},r.payload.doc.data())),this.isLoading=!1,this.errorMsg=null},r=>{this.isLoading=!1,this.errorMsg=r.message})}}return r.\u0275fac=function(e){return new(e||r)(n.Lb(d.a))},r.\u0275cmp=n.Fb({type:r,selectors:[["app-bmw"]],decls:4,vars:3,consts:[[1,"cars-container"],[4,"ngIf"],["class","cars",4,"ngIf"],["class","error-msg",4,"ngIf"],[1,"cars"],[3,"car",4,"ngFor","ngForOf"],[3,"car"],[1,"error-msg"]],template:function(r,e){1&r&&(n.Rb(0,"div",0),n.uc(1,_,2,0,"div",1),n.uc(2,J,2,1,"div",2),n.uc(3,$,2,1,"p",3),n.Qb()),2&r&&(n.Ab(1),n.gc("ngIf",e.isLoading),n.Ab(1),n.gc("ngIf",!e.isLoading),n.Ab(1),n.gc("ngIf",e.errorMsg))},directives:[t.l,m.a,t.k,x],encapsulation:2}),r})();var G=a("Wcq6"),K=a("kmnG"),W=a("FKr1");function z(r,e){1&r&&n.Mb(0,"app-loading-spinner")}function Z(r,e){if(1&r&&(n.Rb(0,"p",15),n.wc(1),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.xc(r.getCarModelsError)}}function rr(r,e){if(1&r&&(n.Rb(0,"p",15),n.wc(1),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.xc(r.getCarManufactureYearError)}}function er(r,e){if(1&r&&(n.Rb(0,"mat-option",16),n.wc(1),n.Qb()),2&r){const r=e.$implicit;n.gc("value",r.name),n.Ab(1),n.yc(" ",r.name," ")}}function ar(r,e){if(1&r&&(n.Rb(0,"mat-option",16),n.wc(1),n.Qb()),2&r){const r=e.$implicit;n.gc("value",r.year),n.Ab(1),n.yc(" ",r.year," ")}}function tr(r,e){1&r&&(n.Rb(0,"div"),n.Mb(1,"img",17),n.Qb())}function sr(r,e){if(1&r){const r=n.Sb();n.Rb(0,"div"),n.Mb(1,"img",6),n.Rb(2,"div",19),n.Yb("click",(function(){n.oc(r);const a=e.index;return n.ac(2).removeCarImg(a)})),n.wc(3,"X"),n.Qb(),n.Qb()}if(2&r){const r=e.$implicit;n.Ab(1),n.gc("src",r,n.pc)}}function ir(r,e){if(1&r&&(n.Rb(0,"div"),n.uc(1,sr,4,1,"div",18),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.gc("ngForOf",r.carImgLocalPaths)}}function cr(r,e){if(1&r&&(n.Rb(0,"p",15),n.wc(1),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.xc(r.sellCarError)}}function nr(r,e){if(1&r&&(n.Rb(0,"p",15),n.wc(1),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.xc(r.uploadCarImgToFirestoreError)}}function or(r,e){if(1&r&&(n.Rb(0,"p",15),n.wc(1),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.xc(r.uploadCarImagesToFirestoreError)}}function lr(r,e){if(1&r&&(n.Rb(0,"p",15),n.wc(1),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.xc(r.getCarImgURLError)}}function gr(r,e){if(1&r&&(n.Rb(0,"p",15),n.wc(1),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.xc(r.getcarImgURLsError)}}let br=(()=>{class r{constructor(r,e,a,t,s,i){this.formBuilder=r,this.firestore=e,this.additionUserInfoService=a,this.angularFireStorage=t,this.generateIdService=s,this.router=i,this.carDefaultImg="../../../assets/img/cell-car/upload-img.png",this.carImgLocalPath=this.carDefaultImg,this.carImgNames=[],this.carImgLocalPaths=[],this.carImgURLs=[],this.carModels=[],this.carManufactureYears=[],this.getCarModelsError=null,this.getCarManufactureYearError=null,this.sellCarError=null,this.uploadCarImgToFirestoreError=null,this.uploadCarImagesToFirestoreError=null,this.getCarImgURLError=null,this.getcarImgURLsError=null,this.isLoading=!1}ngOnInit(){this.sellCarForm=this.formBuilder.group({model:new i.d(null,i.p.required),year:new i.d(null,i.p.required),carImg:new i.d(null,i.p.required),description:new i.d(null,i.p.required),price:new i.d(null,i.p.required),carImgs:new i.d(null)}),this.firestore.getSecondHandCarsLink().subscribe(r=>{this.carModels=r.map(r=>Object.assign({id:r.payload.doc.id},r.payload.doc.data())),this.getCarModelsError=null},r=>{this.getCarModelsError=r.message}),this.firestore.getCarManufactureYear().subscribe(r=>{this.carManufactureYears=r.map(r=>Object.assign({id:r.payload.doc.id},r.payload.doc.data())),this.getCarManufactureYearError=null},r=>{this.getCarManufactureYearError=r.message}),this.additionUserInfoService.getUserAdditionalData(),this.userAdditionalInfoSub=this.additionUserInfoService.userAdditionalDataSubject.subscribe(r=>{this.userAdditionalData=r})}ngOnDestroy(){this.userAdditionalInfoSub.unsubscribe()}onSubmit(r){if(!r.valid)return;this.isLoading=!0;const e=this.generateIdService.generateId();this.onUploadCarImgToFirestore(e).then(()=>{this.onUploadCarImagesToFirestore(e).then(()=>{const a=r.value.model,t=r.value.year,s=r.value.carImg,i=r.value.description.trim(),c=r.value.price,n=this.userAdditionalData[0].email,o=G.firestore.Timestamp.now();this.firestore.setSecondHandCar({model:a,year:t,carImg:s,description:i,price:c,owner:n,id:e,date:o,carImages:r.value.carImgs}).then(()=>{this.isLoading=!1,this.sellCarForm.reset(),localStorage.setItem("sell-buy-car/buy-LastVisitedLink",JSON.stringify("/sell-buy-car/buy/"+a.toLowerCase())),this.router.navigate(["/sell-buy-car/buy/"+a.toLowerCase()]),this.carImgNames=[],this.carImgLocalPaths=[],this.carImgURLs=[],this.carImgLocalPath=this.carDefaultImg,this.sellCarError=null}).catch(r=>{this.sellCarError=r.message})})})}onChooseCarImg(r){if(this.carFile=r.target.files[0],this.carFile){const e=new FileReader;e.onload=r=>{this.carImgLocalPath=r.target.result},e.readAsDataURL(r.target.files[0]),this.carImgName=this.carFile.name.substr(0,this.carFile.name.lastIndexOf("."))}else this.carImgLocalPath=this.carDefaultImg}onUploadCarImgToFirestore(r){return new Promise(e=>{this.angularFireStorage.upload("/carsForSell/"+this.sellCarForm.value.model+"/"+this.userAdditionalData[0].email+"/"+r+"/"+this.carImgName+"-"+this.generateIdService.generateId(),this.carFile).then(r=>{r.ref.getDownloadURL().then(r=>{this.sellCarForm.value.carImg=r,this.getCarImgURLError=null,e()}).catch(r=>{this.getCarImgURLError=r}),this.uploadCarImgToFirestoreError=null}).catch(r=>{this.uploadCarImgToFirestoreError=r.message})})}onChooseCarImgs(r){if(this.carFiles=r.target.files,this.carFiles.length>0)for(let e=0;e<this.carFiles.length;e++){const a=new FileReader;a.onload=r=>{this.carImgLocalPaths.push(r.target.result)},a.readAsDataURL(r.target.files[e]),this.carImgNames.push(this.carFiles[e].name.substr(0,this.carFiles[e].name.lastIndexOf(".")))}else this.carFiles=null,this.carImgLocalPaths=[],this.carImgNames=[]}onUploadCarImagesToFirestore(r){return new Promise(e=>{0==this.carImgNames.length&&e();for(let a=0;a<this.carImgNames.length;a++)this.angularFireStorage.upload("/carsForSell/"+this.sellCarForm.value.model+"/"+this.userAdditionalData[0].email+"/"+r+"//carImages/"+this.carImgNames[a]+"-"+this.generateIdService.generateId(),this.carFiles[a]).then(r=>{r.ref.getDownloadURL().then(r=>{this.carImgURLs.push(r),this.carImgURLs.length==this.carImgNames.length&&(this.sellCarForm.value.carImgs=this.carImgURLs,this.getcarImgURLsError=null,e())}).catch(r=>{this.getcarImgURLsError=r.message}),this.uploadCarImagesToFirestoreError=null}).catch(r=>{this.uploadCarImagesToFirestoreError=r.message})})}removeCarImg(r){this.carImgLocalPaths.splice(r,1),this.carImgNames.splice(r,1),0==this.carImgLocalPaths&&0==this.carImgNames&&(this.sellCarForm.value.carImgs=null)}}return r.\u0275fac=function(e){return new(e||r)(n.Lb(i.c),n.Lb(d.a),n.Lb(p.a),n.Lb(f.a),n.Lb(I.a),n.Lb(s.b))},r.\u0275cmp=n.Fb({type:r,selectors:[["app-sell-car"]],decls:40,vars:15,consts:[[4,"ngIf"],["class","error-msg",4,"ngIf"],[3,"formGroup","ngSubmit"],["formControlName","model"],[3,"value",4,"ngFor","ngForOf"],["formControlName","year"],[3,"src"],["formControlName","carImg","type","file","accept",".png,.jpg,.jpeg,.svg,.heic",2,"display","none",3,"change"],["chooseCarImg",""],["type","button",1,"btn-default","narrow-btn","ng-star-inserted",3,"click"],["placeholder","Description...","formControlName","description"],["type","number","name","price","formControlName","price"],["formControlName","carImgs","type","file","accept",".png,.jpg,.jpeg,.svg,.heic","multiple","multiple",2,"display","none",3,"change"],["chooseCarImgs",""],["type","submit",3,"disabled"],[1,"error-msg"],[3,"value"],["src","../../../assets/img/cell-car/upload-img.png"],[4,"ngFor","ngForOf"],[3,"click"]],template:function(r,e){if(1&r){const r=n.Sb();n.Rb(0,"div"),n.uc(1,z,1,0,"app-loading-spinner",0),n.Rb(2,"div"),n.uc(3,Z,2,1,"p",1),n.uc(4,rr,2,1,"p",1),n.Qb(),n.Rb(5,"form",2),n.Yb("ngSubmit",(function(){return e.onSubmit(e.sellCarForm)})),n.Rb(6,"div"),n.Rb(7,"mat-form-field"),n.Rb(8,"mat-select",3),n.uc(9,er,2,2,"mat-option",4),n.Qb(),n.Qb(),n.Rb(10,"mat-form-field"),n.Rb(11,"mat-select",5),n.uc(12,ar,2,2,"mat-option",4),n.Qb(),n.Qb(),n.Qb(),n.Rb(13,"div"),n.Rb(14,"div"),n.Mb(15,"img",6),n.Qb(),n.Rb(16,"input",7,8),n.Yb("change",(function(r){return e.onChooseCarImg(r)})),n.Qb(),n.Rb(18,"button",9),n.Yb("click",(function(){return n.oc(r),n.mc(17).click()})),n.wc(19,"Ch\u043eose Image"),n.Qb(),n.Qb(),n.Rb(20,"div"),n.Mb(21,"textarea",10),n.Qb(),n.Rb(22,"div"),n.Mb(23,"input",11),n.Qb(),n.Rb(24,"div"),n.uc(25,tr,2,0,"div",0),n.Rb(26,"button",9),n.Yb("click",(function(){return n.oc(r),n.mc(30).click()})),n.wc(27,"Ch\u043eose Images"),n.Qb(),n.uc(28,ir,2,1,"div",0),n.Rb(29,"input",12,13),n.Yb("change",(function(r){return e.onChooseCarImgs(r)})),n.Qb(),n.Qb(),n.Rb(31,"div"),n.Rb(32,"button",14),n.wc(33,"Add to the Shop"),n.Qb(),n.Qb(),n.Rb(34,"div"),n.uc(35,cr,2,1,"p",1),n.uc(36,nr,2,1,"p",1),n.uc(37,or,2,1,"p",1),n.uc(38,lr,2,1,"p",1),n.uc(39,gr,2,1,"p",1),n.Qb(),n.Qb(),n.Qb()}2&r&&(n.Ab(1),n.gc("ngIf",e.isLoading),n.Ab(2),n.gc("ngIf",e.getCarModelsError),n.Ab(1),n.gc("ngIf",e.getCarManufactureYearError),n.Ab(1),n.gc("formGroup",e.sellCarForm),n.Ab(4),n.gc("ngForOf",e.carModels),n.Ab(3),n.gc("ngForOf",e.carManufactureYears),n.Ab(3),n.gc("src",e.carImgLocalPath,n.pc),n.Ab(10),n.gc("ngIf",0==e.carImgLocalPaths.length),n.Ab(3),n.gc("ngIf",e.carImgLocalPaths.length>0),n.Ab(4),n.gc("disabled",!e.sellCarForm.valid),n.Ab(3),n.gc("ngIf",e.sellCarError),n.Ab(1),n.gc("ngIf",e.uploadCarImgToFirestoreError),n.Ab(1),n.gc("ngIf",e.uploadCarImagesToFirestoreError),n.Ab(1),n.gc("ngIf",e.getCarImgURLError),n.Ab(1),n.gc("ngIf",e.getcarImgURLsError))},directives:[t.l,i.q,i.l,i.g,K.b,c.a,i.k,i.e,t.k,i.b,i.n,m.a,W.f],encapsulation:2}),r})();var ur=a("XupT");function dr(r,e){if(1&r&&(n.Rb(0,"p",2),n.wc(1),n.Qb()),2&r){const r=n.ac();n.Ab(1),n.xc(r.getCarLinksErrorMsg)}}let mr=(()=>{class r{constructor(r,e,a){this.firestore=r,this.subjectsService=e,this.router=a,this.carLinks=[]}ngOnInit(){this.isLoadingSub=this.subjectsService.isLoadingSubject.subscribe(r=>{this.isLoading=r}),this.firestore.getSecondHandCarsLink().subscribe(r=>{this.carLinks=r.map(r=>Object.assign({id:r.payload.doc.id},r.payload.doc.data())),this.subjectsService.loaded(),this.getCarLinksErrorMsg=null},r=>{this.subjectsService.loaded(),this.getCarLinksErrorMsg=r.message});const r=JSON.parse(localStorage.getItem("sell-buy-car/buy-LastVisitedLink"));r&&this.router.navigate([r])}ngOnDestroy(){this.isLoadingSub.unsubscribe()}}return r.\u0275fac=function(e){return new(e||r)(n.Lb(d.a),n.Lb(h.a),n.Lb(s.b))},r.\u0275cmp=n.Fb({type:r,selectors:[["app-buy-car"]],decls:3,vars:3,consts:[["class","error-msg",4,"ngIf"],[3,"carLinks","currentLink"],[1,"error-msg"]],template:function(r,e){1&r&&(n.Rb(0,"div"),n.uc(1,dr,2,1,"p",0),n.Mb(2,"app-categories-router",1),n.Qb()),2&r&&(n.Ab(1),n.gc("ngIf",e.getCarLinksErrorMsg),n.Ab(1),n.gc("carLinks",e.carLinks)("currentLink","sell-buy-car/buy"))},directives:[t.l,ur.a],encapsulation:2}),r})();var hr=a("PCNd");let pr=(()=>{class r{}return r.\u0275mod=n.Jb({type:r}),r.\u0275inj=n.Ib({factory:function(e){return new(e||r)},imports:[[t.c,i.o,hr.a,c.b,s.e.forChild([{path:"",component:b,canActivate:[u.a],children:[{path:"buy",component:mr,children:[{path:"audi",component:q},{path:"bmw",component:X},{path:"**",redirectTo:"audi"}]},{path:"sell",component:br},{path:"**",redirectTo:"buy"}]}])]]}),r})()}}]);