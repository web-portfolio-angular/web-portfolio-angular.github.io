(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{F15C:function(e,r,t){"use strict";t.r(r),t.d(r,"SellBuyCarModule",(function(){return A}));var a=t("ofXK"),s=t("tyNb"),i=t("3Pt+"),o=t("d3UM"),c=t("fXoL"),n=t("Vaw3"),l=t("1XCa");const u=function(){return["buy"]},g=function(){return["sell"]};let h=(()=>{class e{constructor(e,r){this.angularFireStorage=e,this.router=r,this.defaultUploadImg="../assets/img/cell-car/upload-img.png",this.imgLocalPath=this.defaultUploadImg,this.imgURL=null,this.errorMsgOnUpload=null}ngOnInit(){const e=JSON.parse(localStorage.getItem("sell-buy-car-LastVisitedLink"));e&&this.router.navigate([e])}uploadImg(e){if(this.file=e.target.files[0],this.file){const r=new FileReader;r.onload=e=>{this.imgLocalPath=e.target.result},r.readAsDataURL(e.target.files[0]),this.imgName=this.file.name.substr(0,this.file.name.lastIndexOf("."))}else this.imgLocalPath=this.defaultUploadImg}uploadImgToFirestorage(){this.angularFireStorage.upload("/cellCar/"+this.imgName+"-"+Math.random().toString(36).substring(2),this.file).then(e=>{e.ref.getDownloadURL().then(e=>{this.imgURL=e}),this.errorMsgOnUpload=null}).catch(e=>{this.errorMsgOnUpload=e.message})}saveLastVisitedLinkToLocalStore(e){localStorage.setItem("sell-buy-car-LastVisitedLink",JSON.stringify("/sell-buy-car/"+e))}}return e.\u0275fac=function(r){return new(r||e)(c.Lb(n.a),c.Lb(s.b))},e.\u0275cmp=c.Fb({type:e,selectors:[["app-sell-buy-car"]],decls:9,vars:4,consts:[[1,"container"],["routerLinkActive","categories-active",3,"routerLink","click"]],template:function(e,r){1&e&&(c.Rb(0,"div",0),c.Mb(1,"app-categories-info"),c.Rb(2,"div"),c.Rb(3,"ul"),c.Rb(4,"li",1),c.Yb("click",(function(){return r.saveLastVisitedLinkToLocalStore("buy")})),c.wc(5,"Buy Second Hand Car"),c.Qb(),c.Rb(6,"li",1),c.Yb("click",(function(){return r.saveLastVisitedLinkToLocalStore("sell")})),c.wc(7," Sell Your Car"),c.Qb(),c.Qb(),c.Mb(8,"router-outlet"),c.Qb(),c.Qb()),2&e&&(c.Ab(4),c.gc("routerLink",c.ic(2,u)),c.Ab(2),c.gc("routerLink",c.ic(3,g)))},directives:[l.a,s.d,s.c,s.f],encapsulation:2}),e})();var m=t("2CTM");let d=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=c.Fb({type:e,selectors:[["app-audi"]],decls:2,vars:0,template:function(e,r){1&e&&(c.Rb(0,"p"),c.wc(1,"audi works!"),c.Qb())},encapsulation:2}),e})(),b=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=c.Fb({type:e,selectors:[["app-bmw"]],decls:2,vars:0,template:function(e,r){1&e&&(c.Rb(0,"p"),c.wc(1,"bmw works!"),c.Qb())},encapsulation:2}),e})();var p=t("Wcq6"),f=t("T/S4"),I=t("V86y"),L=t("B02C"),C=t("kmnG"),v=t("FKr1");function S(e,r){if(1&e&&(c.Rb(0,"mat-option",14),c.wc(1),c.Qb()),2&e){const e=r.$implicit;c.gc("value",e.car),c.Ab(1),c.yc(" ",e.car," ")}}function F(e,r){if(1&e&&(c.Rb(0,"mat-option",14),c.wc(1),c.Qb()),2&e){const e=r.$implicit;c.gc("value",e.year),c.Ab(1),c.yc(" ",e.year," ")}}function R(e,r){1&e&&(c.Rb(0,"div"),c.Mb(1,"img",15),c.Qb())}function y(e,r){if(1&e){const e=c.Sb();c.Rb(0,"div"),c.Mb(1,"img",4),c.Rb(2,"div",17),c.Yb("click",(function(){c.oc(e);const t=r.index;return c.ac(2).removeCarImg(t)})),c.wc(3,"X"),c.Qb(),c.Qb()}if(2&e){const e=r.$implicit;c.Ab(1),c.gc("src",e,c.pc)}}function w(e,r){if(1&e&&(c.Rb(0,"div"),c.uc(1,y,4,1,"div",16),c.Qb()),2&e){const e=c.ac();c.Ab(1),c.gc("ngForOf",e.carImgLocalPaths)}}let k=(()=>{class e{constructor(e,r,t,a,s){this.formBuilder=e,this.firestore=r,this.additionUserInfoService=t,this.angularFireStorage=a,this.generateIdService=s,this.carDefaultImg="../../../assets/img/cell-car/upload-img.png",this.carImgLocalPath=this.carDefaultImg,this.carImgNames=[],this.carImgLocalPaths=[],this.carImgURLs=[],this.carModels=[],this.carManufactureYears=[],this.getCarModelsError=null,this.getCarManufactureYearError=null,this.sellCarError=null,this.uploadCarImgToFirestoreError=null,this.uploadCarImagesToFirestoreError=null,this.getCarImgURLError=null,this.getcarImgURLsError=null}ngOnInit(){this.sellCarForm=this.formBuilder.group({model:new i.d(null,i.p.required),year:new i.d(null,i.p.required),carImg:new i.d(null,i.p.required),description:new i.d(null,i.p.required),price:new i.d(null,i.p.required),carImgs:new i.d(null)}),this.firestore.getCarModels().subscribe(e=>{this.carModels=e.map(e=>Object.assign({id:e.payload.doc.id},e.payload.doc.data())),this.getCarModelsError=null},e=>{this.getCarModelsError=e.message}),this.firestore.getCarManufactureYear().subscribe(e=>{this.carManufactureYears=e.map(e=>Object.assign({id:e.payload.doc.id},e.payload.doc.data())),this.getCarManufactureYearError=null},e=>{this.getCarManufactureYearError=e.message}),this.additionUserInfoService.getUserAdditionalData(),this.userAdditionalInfoSub=this.additionUserInfoService.userAdditionalDataSubject.subscribe(e=>{this.userAdditionalData=e})}ngOnDestroy(){this.userAdditionalInfoSub.unsubscribe()}onSubmit(e){if(!e.valid)return;const r=this.generateIdService.generateId();this.onUploadCarImgToFirestore(r).then(()=>{this.onUploadCarImagesToFirestore(r).then(()=>{const t=e.value.model,a=e.value.year,s=e.value.carImg,i=e.value.description.trim(),o=e.value.price,c=this.userAdditionalData[0].email,n=p.firestore.Timestamp.now(),l={model:t,year:a,carImg:s,description:i,price:o,userEmail:c,id:r,date:n,carImages:e.value.carImgs};switch(t){case"Audi":this.firestore.secondHandAudi(l).then(()=>{this.onSuccessfulSetCarForSell()}).catch(e=>{this.onErroSetCarForSell(e)});break;case"BWM":this.firestore.secondHandBmw(l).then(()=>{this.onSuccessfulSetCarForSell()}).catch(e=>{this.onErroSetCarForSell(e)})}})})}onSuccessfulSetCarForSell(){this.sellCarForm.reset(),this.carImgNames=[],this.carImgLocalPaths=[],this.carImgURLs=[],this.carImgLocalPath=this.carDefaultImg,this.sellCarError=null}onErroSetCarForSell(e){this.sellCarError=e.message}onChooseCarImg(e){if(this.carFile=e.target.files[0],this.carFile){const r=new FileReader;r.onload=e=>{this.carImgLocalPath=e.target.result},r.readAsDataURL(e.target.files[0]),this.carImgName=this.carFile.name.substr(0,this.carFile.name.lastIndexOf("."))}else this.carImgLocalPath=this.carDefaultImg}onUploadCarImgToFirestore(e){return new Promise(r=>{this.angularFireStorage.upload("/carsForSell/"+this.sellCarForm.value.model+"/"+this.userAdditionalData[0].email+"/"+e+"/"+this.carImgName+"-"+this.generateIdService.generateId(),this.carFile).then(e=>{e.ref.getDownloadURL().then(e=>{this.sellCarForm.value.carImg=e,this.getCarImgURLError=null,r()}).catch(e=>{this.getCarImgURLError=e}),this.uploadCarImgToFirestoreError=null}).catch(e=>{this.uploadCarImgToFirestoreError=e.message})})}onChooseCarImgs(e){if(this.carFiles=e.target.files,this.carFiles)for(let r=0;r<this.carFiles.length;r++){const t=new FileReader;t.onload=e=>{this.carImgLocalPaths.push(e.target.result)},t.readAsDataURL(e.target.files[r]),this.carImgNames.push(this.carFiles[r].name.substr(0,this.carFiles[r].name.lastIndexOf(".")))}}onUploadCarImagesToFirestore(e){return new Promise(r=>{0==this.carImgNames.length&&r();for(let t=0;t<this.carImgNames.length;t++)this.angularFireStorage.upload("/carsForSell/"+this.sellCarForm.value.model+"/"+this.userAdditionalData[0].email+"/"+e+"//carImages/"+this.carImgNames[t]+"-"+this.generateIdService.generateId(),this.carFile).then(e=>{e.ref.getDownloadURL().then(e=>{this.carImgURLs.push(e),this.carImgURLs.length==this.carImgNames.length&&(this.sellCarForm.value.carImgs=this.carImgURLs,this.getcarImgURLsError=null,r())}).catch(e=>{this.getcarImgURLsError=e.message}),this.uploadCarImagesToFirestoreError=null}).catch(e=>{this.uploadCarImagesToFirestoreError=e.message})})}removeCarImg(e){this.carImgLocalPaths.splice(e,1),this.carImgNames.splice(e,1),0==this.carImgLocalPaths&&0==this.carImgNames&&(this.sellCarForm.value.carImgs=null)}}return e.\u0275fac=function(r){return new(r||e)(c.Lb(i.c),c.Lb(f.a),c.Lb(I.a),c.Lb(n.a),c.Lb(L.a))},e.\u0275cmp=c.Fb({type:e,selectors:[["app-sell-car"]],decls:30,vars:7,consts:[[3,"formGroup","ngSubmit"],["formControlName","model"],[3,"value",4,"ngFor","ngForOf"],["formControlName","year"],[3,"src"],["formControlName","carImg","type","file","accept",".png,.jpg,.jpeg,.svg,.heic",2,"display","none",3,"change"],["chooseCarImg",""],["type","button",1,"btn-default","narrow-btn","ng-star-inserted",3,"click"],["placeholder","Description...","formControlName","description"],["type","number","name","price","formControlName","price"],[4,"ngIf"],["formControlName","carImgs","type","file","accept",".png,.jpg,.jpeg,.svg,.heic","multiple","multiple",2,"display","none",3,"change"],["chooseCarImgs",""],["type","submit",3,"disabled"],[3,"value"],["src","../../../assets/img/cell-car/upload-img.png"],[4,"ngFor","ngForOf"],[3,"click"]],template:function(e,r){if(1&e){const e=c.Sb();c.Rb(0,"div"),c.Rb(1,"form",0),c.Yb("ngSubmit",(function(){return r.onSubmit(r.sellCarForm)})),c.Rb(2,"div"),c.Rb(3,"mat-form-field"),c.Rb(4,"mat-select",1),c.uc(5,S,2,2,"mat-option",2),c.Qb(),c.Qb(),c.Rb(6,"mat-form-field"),c.Rb(7,"mat-select",3),c.uc(8,F,2,2,"mat-option",2),c.Qb(),c.Qb(),c.Qb(),c.Rb(9,"div"),c.Rb(10,"div"),c.Mb(11,"img",4),c.Qb(),c.Rb(12,"input",5,6),c.Yb("change",(function(e){return r.onChooseCarImg(e)})),c.Qb(),c.Rb(14,"button",7),c.Yb("click",(function(){return c.oc(e),c.mc(13).click()})),c.wc(15,"Ch\u043eose Image"),c.Qb(),c.Qb(),c.Rb(16,"div"),c.Mb(17,"textarea",8),c.Qb(),c.Rb(18,"div"),c.Mb(19,"input",9),c.Qb(),c.Rb(20,"div"),c.uc(21,R,2,0,"div",10),c.Rb(22,"button",7),c.Yb("click",(function(){return c.oc(e),c.mc(26).click()})),c.wc(23,"Ch\u043eose Images"),c.Qb(),c.uc(24,w,2,1,"div",10),c.Rb(25,"input",11,12),c.Yb("change",(function(e){return r.onChooseCarImgs(e)})),c.Qb(),c.Qb(),c.Rb(27,"div"),c.Rb(28,"button",13),c.wc(29,"Add to the Shop"),c.Qb(),c.Qb(),c.Qb(),c.Qb()}2&e&&(c.Ab(1),c.gc("formGroup",r.sellCarForm),c.Ab(4),c.gc("ngForOf",r.carModels),c.Ab(3),c.gc("ngForOf",r.carManufactureYears),c.Ab(3),c.gc("src",r.carImgLocalPath,c.pc),c.Ab(10),c.gc("ngIf",0==r.carImgLocalPaths.length),c.Ab(3),c.gc("ngIf",r.carImgLocalPaths.length>0),c.Ab(4),c.gc("disabled",!r.sellCarForm.valid))},directives:[i.q,i.l,i.g,C.b,o.a,i.k,i.e,a.k,i.b,i.n,a.l,v.f],encapsulation:2}),e})();var M=t("rL3l"),U=t("XupT");let E=(()=>{class e{constructor(e,r,t){this.firestore=e,this.subjectsService=r,this.router=t,this.carLinks=[]}ngOnInit(){this.isLoadingSub=this.subjectsService.isLoadingSubject.subscribe(e=>{this.isLoading=e}),this.getCarLinksErrorMsgSub=this.subjectsService.getCarLinksErrorMsgSubject.subscribe(e=>{this.getCarLinksErrorMsg=e}),this.firestore.getSecondHandCars().subscribe(e=>{this.carLinks=e.map(e=>Object.assign({id:e.payload.doc.id},e.payload.doc.data())),this.subjectsService.loaded(),this.subjectsService.clearGetProductLinksError()},e=>{this.subjectsService.loaded(),this.subjectsService.onGetProductLinksError(e)});const e=JSON.parse(localStorage.getItem("sell-buy-car/buy-LastVisitedLink"));e&&this.router.navigate([e])}ngOnDestroy(){this.isLoadingSub.unsubscribe(),this.getCarLinksErrorMsgSub.unsubscribe()}}return e.\u0275fac=function(r){return new(r||e)(c.Lb(f.a),c.Lb(M.a),c.Lb(s.b))},e.\u0275cmp=c.Fb({type:e,selectors:[["app-buy-car"]],decls:1,vars:2,consts:[[3,"carLinks","currentLink"]],template:function(e,r){1&e&&c.Mb(0,"app-categories-router",0),2&e&&c.gc("carLinks",r.carLinks)("currentLink","sell-buy-car/buy")},directives:[U.a],encapsulation:2}),e})();var Q=t("PCNd");let A=(()=>{class e{}return e.\u0275mod=c.Jb({type:e}),e.\u0275inj=c.Ib({factory:function(r){return new(r||e)},imports:[[a.c,i.o,Q.a,o.b,s.e.forChild([{path:"",component:h,canActivate:[m.a],children:[{path:"buy",component:E,children:[{path:"audi",component:d},{path:"bmw",component:b},{path:"**",redirectTo:"audi"}]},{path:"sell",component:k},{path:"**",redirectTo:"buy"}]}])]]}),e})()}}]);