<div class="car-buy-item car-item">
  <app-loading-spinner *ngIf="isLoading"></app-loading-spinner>
  <div>
    <img class="car-item__img" [src]="car.carImg">
  </div>
  <div class="car-buy-item__model">
    <p>{{ car.model }}</p>
    <p>{{ car.year }}</p>
  </div>
  <hr class="car-item__hr">
  <div class="car-buy-item__description">
    <p>{{ car.description }}</p>
  </div>
  <hr class="car-item__hr">
  <div class="car-item__prise">
    <div>
      <p>&#36; {{ car.price }}</p>
    </div>
    <div class="add-to-cart">
      <p>Add to Cart</p>
    </div>
  </div>
  <hr class="car-item__hr">
  <div class="car-buy-item__owner-info">
    <div class="owner">
      <p>Owner</p>
      <div *ngIf="ownerEmail == car.owner">
        <button class="btn-default narrow-btn" type="button" (click)="onEdit()">Edit Car</button>
      </div>
    </div>
    <div class="owner-avatar" [ngStyle]="{'background-image': (car.owner | getUserInfo:'userImg' | async)}">
    </div>
    <div class="owner-info">
      <p>Name: {{car.owner | getUserInfo:'name' | async}}</p>
      <p>
        Phone:
        <a href="tel:
            {{car.owner | getUserInfo:'phoneCode' | async}}
            {{car.owner | getUserInfo:'phone' | async}}">
          +{{car.owner | getUserInfo:'phoneCode' | async}} {{car.owner | getUserInfo:'phone' | async}}
        </a>
      </p>
      <p>Email: <a href="mailto:{{ car.owner }}">{{ car.owner }}</a></p>
    </div>
  </div>
  <div>
    <p>Created: {{ car.date.toDate() | date:'dd.MM.yyyy' }}</p>
  </div>
  <div>
    <div *ngIf="car.carImages" class="car-item__images">
      <button class="btn-default narrow-btn" (click)="onShowCarImages(car.id)">View Images</button>
      <app-car-images *ngIf="carShowImages && carId==car.id" [carImgs]="car.carImages"></app-car-images>
    </div>
    <p class="no-car-images" *ngIf="car.carImages.length == 0">There are no images uploaded</p>
  </div>




  <div class="test" *ngIf="isInEditMode">
    <form [formGroup]="changeCarDetailsForm" (ngSubmit)="submitCarDetailChanges(changeCarDetailsForm)">
      <div>
        <input formControlName="carImg" #chooseCarImg style="display: none;" type="file"
          (change)="onChooseCarImg($event)" accept=".png,.jpg,.jpeg,.svg,.heic">
        <img [src]="carImgLocalPath">
        <button type="button" (click)="chooseCarImg.click()">Change Car Image</button>
      </div>
      <div>
        <textarea formControlName="description"></textarea>
      </div>
      <div>
        <input type="number" name="price" formControlName="price">
      </div>
      <div>
        <div>
          <div *ngIf="!car.carImages">
            <p>There are no images uploaded</p>
          </div>
          <div *ngIf="currentCarImages.length > 0">
            <p>Current Images</p>
            <div *ngFor="let carImage of currentCarImages; let i = index">
              <img [src]="carImage">
              <div (click)="deleteCurrentImages(i, carImage)">X</div>
            </div>
          </div>
          <div *ngIf="carImgLocalPaths.length > 0">
            <p>New Images</p>
            <div>
              <div *ngFor="let carImage of carImgLocalPaths let i = index">
                <img [src]="carImage">
                <div (click)="removeCarImg(i)">X</div>
              </div>
            </div>
          </div>
        </div>
        <div>
          <input formControlName="carImgs" #chooseCarImgs style="display: none;" type="file"
            (change)="onChooseCarImgs($event)" accept=".png,.jpg,.jpeg,.svg,.heic" multiple="multiple">
          <button type="button" class="btn-default narrow-btn ng-star-inserted" (click)="chooseCarImgs.click()">
            <p *ngIf="!currentCarImages">Select Images</p>
            <p *ngIf="currentCarImages">Select More Images</p>
          </button>
        </div>
      </div>
      <div>
        <button type="submit">Apply Changes</button>
        <button type="button" (click)="onCancel()">Cancel</button>
      </div>
      <div>
        <p *ngIf="uploadCarImagesToFirestoreError" class="error-msg">{{ uploadCarImagesToFirestoreError }}</p>
        <p *ngIf="updateSecondHandCarError" class="error-msg">{{ updateSecondHandCarError }}</p>
        <p *ngIf="setcarImgURLsError" class="error-msg">{{ setcarImgURLsError }}</p>
        <p *ngIf="deleteOldImgError" class="error-msg">{{ deleteOldImgError }}</p>
        <p *ngIf="getCarImgURLError" class="error-msg">{{ getCarImgURLError }}</p>
        <p *ngIf="uploadCarImgToFirestoreError" class="error-msg">{{ uploadCarImgToFirestoreError }}</p>
      </div>
    </form>
  </div>
</div>

<!--  -->
<style>
  .test {
    position: fixed;
    top: 50px;
    left: 0;
    width: 100%;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.5);
  }

  img {
    width: 100px;
  }
</style>