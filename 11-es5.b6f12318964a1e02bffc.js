!function(){function e(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function r(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function a(e,a,t){return a&&r(e.prototype,a),t&&r(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{F15C:function(r,t,i){"use strict";i.r(t),i.d(t,"SellBuyCarModule",(function(){return V}));var n,o,c,s=i("ofXK"),l=i("tyNb"),u=i("3Pt+"),g=i("d3UM"),m=i("fXoL"),d=i("Vaw3"),f=i("1XCa"),b=function(){return["buy"]},h=function(){return["sell"]},p=((n=function(){function r(a,t){e(this,r),this.angularFireStorage=a,this.router=t,this.defaultUploadImg="../assets/img/cell-car/upload-img.png",this.imgLocalPath=this.defaultUploadImg,this.imgURL=null,this.errorMsgOnUpload=null}return a(r,[{key:"ngOnInit",value:function(){var e=JSON.parse(localStorage.getItem("sell-buy-car-LastVisitedLink"));e&&this.router.navigate([e])}},{key:"uploadImg",value:function(e){var r=this;if(this.file=e.target.files[0],this.file){var a=new FileReader;a.onload=function(e){r.imgLocalPath=e.target.result},a.readAsDataURL(e.target.files[0]),this.imgName=this.file.name.substr(0,this.file.name.lastIndexOf("."))}else this.imgLocalPath=this.defaultUploadImg}},{key:"uploadImgToFirestorage",value:function(){var e=this;this.angularFireStorage.upload("/cellCar/"+this.imgName+"-"+Math.random().toString(36).substring(2),this.file).then((function(r){r.ref.getDownloadURL().then((function(r){e.imgURL=r})),e.errorMsgOnUpload=null})).catch((function(r){e.errorMsgOnUpload=r.message}))}},{key:"saveLastVisitedLinkToLocalStore",value:function(e){localStorage.setItem("sell-buy-car-LastVisitedLink",JSON.stringify("/sell-buy-car/"+e))}}]),r}()).\u0275fac=function(e){return new(e||n)(m.Lb(d.a),m.Lb(l.b))},n.\u0275cmp=m.Fb({type:n,selectors:[["app-sell-buy-car"]],decls:9,vars:4,consts:[[1,"container"],["routerLinkActive","categories-active",3,"routerLink","click"]],template:function(e,r){1&e&&(m.Rb(0,"div",0),m.Mb(1,"app-categories-info"),m.Rb(2,"div"),m.Rb(3,"ul"),m.Rb(4,"li",1),m.Yb("click",(function(){return r.saveLastVisitedLinkToLocalStore("buy")})),m.wc(5,"Buy Second Hand Car"),m.Qb(),m.Rb(6,"li",1),m.Yb("click",(function(){return r.saveLastVisitedLinkToLocalStore("sell")})),m.wc(7," Sell Your Car"),m.Qb(),m.Qb(),m.Mb(8,"router-outlet"),m.Qb(),m.Qb()),2&e&&(m.Ab(4),m.gc("routerLink",m.ic(2,b)),m.Ab(2),m.gc("routerLink",m.ic(3,h)))},directives:[f.a,l.d,l.c,l.f],encapsulation:2}),n),v=i("2CTM"),I=((c=function(){function r(){e(this,r)}return a(r,[{key:"ngOnInit",value:function(){}}]),r}()).\u0275fac=function(e){return new(e||c)},c.\u0275cmp=m.Fb({type:c,selectors:[["app-audi"]],decls:2,vars:0,template:function(e,r){1&e&&(m.Rb(0,"p"),m.wc(1,"audi works!"),m.Qb())},encapsulation:2}),c),L=((o=function(){function r(){e(this,r)}return a(r,[{key:"ngOnInit",value:function(){}}]),r}()).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=m.Fb({type:o,selectors:[["app-bmw"]],decls:2,vars:0,template:function(e,r){1&e&&(m.Rb(0,"p"),m.wc(1,"bmw works!"),m.Qb())},encapsulation:2}),o),C=i("Wcq6"),y=i("T/S4"),S=i("V86y"),F=i("B02C"),k=i("kmnG"),R=i("FKr1");function w(e,r){if(1&e&&(m.Rb(0,"mat-option",14),m.wc(1),m.Qb()),2&e){var a=r.$implicit;m.gc("value",a.car),m.Ab(1),m.yc(" ",a.car," ")}}function M(e,r){if(1&e&&(m.Rb(0,"mat-option",14),m.wc(1),m.Qb()),2&e){var a=r.$implicit;m.gc("value",a.year),m.Ab(1),m.yc(" ",a.year," ")}}function U(e,r){1&e&&(m.Rb(0,"div"),m.Mb(1,"img",15),m.Qb())}function E(e,r){if(1&e){var a=m.Sb();m.Rb(0,"div"),m.Mb(1,"img",4),m.Rb(2,"div",17),m.Yb("click",(function(){m.oc(a);var e=r.index;return m.ac(2).removeCarImg(e)})),m.wc(3,"X"),m.Qb(),m.Qb()}if(2&e){var t=r.$implicit;m.Ab(1),m.gc("src",t,m.pc)}}function Q(e,r){if(1&e&&(m.Rb(0,"div"),m.uc(1,E,4,1,"div",16),m.Qb()),2&e){var a=m.ac();m.Ab(1),m.gc("ngForOf",a.carImgLocalPaths)}}var A,O,N,P=((A=function(){function r(a,t,i,n,o){e(this,r),this.formBuilder=a,this.firestore=t,this.additionUserInfoService=i,this.angularFireStorage=n,this.generateIdService=o,this.carDefaultImg="../../../assets/img/cell-car/upload-img.png",this.carImgLocalPath=this.carDefaultImg,this.carImgNames=[],this.carImgLocalPaths=[],this.carImgURLs=[],this.carModels=[],this.carManufactureYears=[],this.getCarModelsError=null,this.getCarManufactureYearError=null,this.sellCarError=null,this.uploadCarImgToFirestoreError=null,this.uploadCarImagesToFirestoreError=null,this.getCarImgURLError=null,this.getcarImgURLsError=null}return a(r,[{key:"ngOnInit",value:function(){var e=this;this.sellCarForm=this.formBuilder.group({model:new u.d(null,u.p.required),year:new u.d(null,u.p.required),carImg:new u.d(null,u.p.required),description:new u.d(null,u.p.required),price:new u.d(null,u.p.required),carImgs:new u.d(null)}),this.firestore.getCarModels().subscribe((function(r){e.carModels=r.map((function(e){return Object.assign({id:e.payload.doc.id},e.payload.doc.data())})),e.getCarModelsError=null}),(function(r){e.getCarModelsError=r.message})),this.firestore.getCarManufactureYear().subscribe((function(r){e.carManufactureYears=r.map((function(e){return Object.assign({id:e.payload.doc.id},e.payload.doc.data())})),e.getCarManufactureYearError=null}),(function(r){e.getCarManufactureYearError=r.message})),this.additionUserInfoService.getUserAdditionalData(),this.userAdditionalInfoSub=this.additionUserInfoService.userAdditionalDataSubject.subscribe((function(r){e.userAdditionalData=r}))}},{key:"ngOnDestroy",value:function(){this.userAdditionalInfoSub.unsubscribe()}},{key:"onSubmit",value:function(e){var r=this;if(e.valid){var a=this.generateIdService.generateId();this.onUploadCarImgToFirestore(a).then((function(){r.onUploadCarImagesToFirestore(a).then((function(){var t=e.value.model,i=e.value.year,n=e.value.carImg,o=e.value.description.trim(),c=e.value.price,s=r.userAdditionalData[0].email,l=C.firestore.Timestamp.now(),u={model:t,year:i,carImg:n,description:o,price:c,userEmail:s,id:a,date:l,carImages:e.value.carImgs};switch(t){case"Audi":r.firestore.secondHandAudi(u).then((function(){r.onSuccessfulSetCarForSell()})).catch((function(e){r.onErroSetCarForSell(e)}));break;case"BWM":r.firestore.secondHandBmw(u).then((function(){r.onSuccessfulSetCarForSell()})).catch((function(e){r.onErroSetCarForSell(e)}))}}))}))}}},{key:"onSuccessfulSetCarForSell",value:function(){this.sellCarForm.reset(),this.carImgNames=[],this.carImgLocalPaths=[],this.carImgURLs=[],this.carImgLocalPath=this.carDefaultImg,this.sellCarError=null}},{key:"onErroSetCarForSell",value:function(e){this.sellCarError=e.message}},{key:"onChooseCarImg",value:function(e){var r=this;if(this.carFile=e.target.files[0],this.carFile){var a=new FileReader;a.onload=function(e){r.carImgLocalPath=e.target.result},a.readAsDataURL(e.target.files[0]),this.carImgName=this.carFile.name.substr(0,this.carFile.name.lastIndexOf("."))}else this.carImgLocalPath=this.carDefaultImg}},{key:"onUploadCarImgToFirestore",value:function(e){var r=this;return new Promise((function(a){r.angularFireStorage.upload("/carsForSell/"+r.sellCarForm.value.model+"/"+r.userAdditionalData[0].email+"/"+e+"/"+r.carImgName+"-"+r.generateIdService.generateId(),r.carFile).then((function(e){e.ref.getDownloadURL().then((function(e){r.sellCarForm.value.carImg=e,r.getCarImgURLError=null,a()})).catch((function(e){r.getCarImgURLError=e})),r.uploadCarImgToFirestoreError=null})).catch((function(e){r.uploadCarImgToFirestoreError=e.message}))}))}},{key:"onChooseCarImgs",value:function(e){var r=this;if(this.carFiles=e.target.files,this.carFiles)for(var a=0;a<this.carFiles.length;a++){var t=new FileReader;t.onload=function(e){r.carImgLocalPaths.push(e.target.result)},t.readAsDataURL(e.target.files[a]),this.carImgNames.push(this.carFiles[a].name.substr(0,this.carFiles[a].name.lastIndexOf(".")))}}},{key:"onUploadCarImagesToFirestore",value:function(e){var r=this;return new Promise((function(a){0==r.carImgNames.length&&a();for(var t=0;t<r.carImgNames.length;t++)r.angularFireStorage.upload("/carsForSell/"+r.sellCarForm.value.model+"/"+r.userAdditionalData[0].email+"/"+e+"//carImages/"+r.carImgNames[t]+"-"+r.generateIdService.generateId(),r.carFile).then((function(e){e.ref.getDownloadURL().then((function(e){r.carImgURLs.push(e),r.carImgURLs.length==r.carImgNames.length&&(r.sellCarForm.value.carImgs=r.carImgURLs,r.getcarImgURLsError=null,a())})).catch((function(e){r.getcarImgURLsError=e.message})),r.uploadCarImagesToFirestoreError=null})).catch((function(e){r.uploadCarImagesToFirestoreError=e.message}))}))}},{key:"removeCarImg",value:function(e){this.carImgLocalPaths.splice(e,1),this.carImgNames.splice(e,1),0==this.carImgLocalPaths&&0==this.carImgNames&&(this.sellCarForm.value.carImgs=null)}}]),r}()).\u0275fac=function(e){return new(e||A)(m.Lb(u.c),m.Lb(y.a),m.Lb(S.a),m.Lb(d.a),m.Lb(F.a))},A.\u0275cmp=m.Fb({type:A,selectors:[["app-sell-car"]],decls:30,vars:7,consts:[[3,"formGroup","ngSubmit"],["formControlName","model"],[3,"value",4,"ngFor","ngForOf"],["formControlName","year"],[3,"src"],["formControlName","carImg","type","file","accept",".png,.jpg,.jpeg,.svg,.heic",2,"display","none",3,"change"],["chooseCarImg",""],["type","button",1,"btn-default","narrow-btn","ng-star-inserted",3,"click"],["placeholder","Description...","formControlName","description"],["type","number","name","price","formControlName","price"],[4,"ngIf"],["formControlName","carImgs","type","file","accept",".png,.jpg,.jpeg,.svg,.heic","multiple","multiple",2,"display","none",3,"change"],["chooseCarImgs",""],["type","submit",3,"disabled"],[3,"value"],["src","../../../assets/img/cell-car/upload-img.png"],[4,"ngFor","ngForOf"],[3,"click"]],template:function(e,r){if(1&e){var a=m.Sb();m.Rb(0,"div"),m.Rb(1,"form",0),m.Yb("ngSubmit",(function(){return r.onSubmit(r.sellCarForm)})),m.Rb(2,"div"),m.Rb(3,"mat-form-field"),m.Rb(4,"mat-select",1),m.uc(5,w,2,2,"mat-option",2),m.Qb(),m.Qb(),m.Rb(6,"mat-form-field"),m.Rb(7,"mat-select",3),m.uc(8,M,2,2,"mat-option",2),m.Qb(),m.Qb(),m.Qb(),m.Rb(9,"div"),m.Rb(10,"div"),m.Mb(11,"img",4),m.Qb(),m.Rb(12,"input",5,6),m.Yb("change",(function(e){return r.onChooseCarImg(e)})),m.Qb(),m.Rb(14,"button",7),m.Yb("click",(function(){return m.oc(a),m.mc(13).click()})),m.wc(15,"Ch\u043eose Image"),m.Qb(),m.Qb(),m.Rb(16,"div"),m.Mb(17,"textarea",8),m.Qb(),m.Rb(18,"div"),m.Mb(19,"input",9),m.Qb(),m.Rb(20,"div"),m.uc(21,U,2,0,"div",10),m.Rb(22,"button",7),m.Yb("click",(function(){return m.oc(a),m.mc(26).click()})),m.wc(23,"Ch\u043eose Images"),m.Qb(),m.uc(24,Q,2,1,"div",10),m.Rb(25,"input",11,12),m.Yb("change",(function(e){return r.onChooseCarImgs(e)})),m.Qb(),m.Qb(),m.Rb(27,"div"),m.Rb(28,"button",13),m.wc(29,"Add to the Shop"),m.Qb(),m.Qb(),m.Qb(),m.Qb()}2&e&&(m.Ab(1),m.gc("formGroup",r.sellCarForm),m.Ab(4),m.gc("ngForOf",r.carModels),m.Ab(3),m.gc("ngForOf",r.carManufactureYears),m.Ab(3),m.gc("src",r.carImgLocalPath,m.pc),m.Ab(10),m.gc("ngIf",0==r.carImgLocalPaths.length),m.Ab(3),m.gc("ngIf",r.carImgLocalPaths.length>0),m.Ab(4),m.gc("disabled",!r.sellCarForm.valid))},directives:[u.q,u.l,u.g,k.b,g.a,u.k,u.e,s.k,u.b,u.n,s.l,R.f],encapsulation:2}),A),T=i("rL3l"),j=i("XupT"),D=((O=function(){function r(a,t,i){e(this,r),this.firestore=a,this.subjectsService=t,this.router=i,this.carLinks=[]}return a(r,[{key:"ngOnInit",value:function(){var e=this;this.isLoadingSub=this.subjectsService.isLoadingSubject.subscribe((function(r){e.isLoading=r})),this.getCarLinksErrorMsgSub=this.subjectsService.getCarLinksErrorMsgSubject.subscribe((function(r){e.getCarLinksErrorMsg=r})),this.firestore.getSecondHandCars().subscribe((function(r){e.carLinks=r.map((function(e){return Object.assign({id:e.payload.doc.id},e.payload.doc.data())})),e.subjectsService.loaded(),e.subjectsService.clearGetProductLinksError()}),(function(r){e.subjectsService.loaded(),e.subjectsService.onGetProductLinksError(r)}));var r=JSON.parse(localStorage.getItem("sell-buy-car/buy-LastVisitedLink"));r&&this.router.navigate([r])}},{key:"ngOnDestroy",value:function(){this.isLoadingSub.unsubscribe(),this.getCarLinksErrorMsgSub.unsubscribe()}}]),r}()).\u0275fac=function(e){return new(e||O)(m.Lb(y.a),m.Lb(T.a),m.Lb(l.b))},O.\u0275cmp=m.Fb({type:O,selectors:[["app-buy-car"]],decls:1,vars:2,consts:[[3,"carLinks","currentLink"]],template:function(e,r){1&e&&m.Mb(0,"app-categories-router",0),2&e&&m.gc("carLinks",r.carLinks)("currentLink","sell-buy-car/buy")},directives:[j.a],encapsulation:2}),O),Y=i("PCNd"),V=((N=function r(){e(this,r)}).\u0275mod=m.Jb({type:N}),N.\u0275inj=m.Ib({factory:function(e){return new(e||N)},imports:[[s.c,u.o,Y.a,g.b,l.e.forChild([{path:"",component:p,canActivate:[v.a],children:[{path:"buy",component:D,children:[{path:"audi",component:I},{path:"bmw",component:L},{path:"**",redirectTo:"audi"}]},{path:"sell",component:P},{path:"**",redirectTo:"buy"}]}])]]}),N)}}])}();